function doRefresh(){}function doAlert(e){alert(e)}function doRedirect(e,o){alert(e),location.href=o}function dealWithAjaxData(e,o){if(common.log(e,o),"ok"==o.result)return!0;switch(""+o.error_code){case"40001":reLogin();break;case"42032":common.wechatAuthorize()}return!1}function reLogin(){setCookie("AccessToken","",0),common.login(!0)}function sortByJoinedTime(e,o){var n=new Date(e.join_time),t=new Date(o.join_time);return n>t}function getCookie(e){return document.cookie.length>0&&(c_start=document.cookie.indexOf(e+"="),-1!=c_start)?(c_start=c_start+e.length+1,c_end=document.cookie.indexOf(";",c_start),-1==c_end&&(c_end=document.cookie.length),unescape(document.cookie.substring(c_start,c_end))):""}function setCookie(e,o,n){var t=e+"="+o+"; ",i="";null!==n&&void 0!==n&&(i="expires="+new Date(1e3*n)+"; "),document.cookie=t+i+"path=/"}function getWeishopAccessToken(){return getCookie("AccessToken")}function checkWeishopSession(e){var o=getWeishopAccessToken();""==o&&forceWeishopLogin(e)}function isWeChatBrowser(){var e=navigator.userAgent.toLowerCase();return"micromessenger"==e.match(/MicroMessenger/i)?!0:!1}var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="//hm.baidu.com/hm.js?f48003229bca97589cf6bf7fe72942cd";var o=document.getElementsByTagName("script")[0];o.parentNode.insertBefore(e,o)}(),function(){document.write('<script src="http://s95.cnzz.com/z_stat.php?id=1254672111&web_id=1254672111" language="JavaScript"></script>')}(),AJAXFlag=!0;var common={isDebug:!1,getApi:function(e){return MasterConfig.C("baseUrl")+e+"&app_id="+MasterConfig.C("appId")},invokeApi:function(e,o,n,t,i,r){if(common.alert("url: "+o),AJAXFlag){(null===t||void 0===t)&&(t=function(){}),(null===i||void 0===i)&&(i=function(){}),(null===r||void 0===r)&&(r=function(){});var c={url:this.getApi(o),type:e,xhrFields:{withCredentials:!0},dataType:"json",beforeSend:t,success:function(e){common.alert("success data: "+JSON.stringify(e)),dealWithAjaxData(o,e)?i(e):r(e)},error:function(e){common.alert("error data: "+JSON.stringify(e)),common.clearLoading()}};null!==n&&void 0!==n&&(c.data=n,"PUT"==e&&(c.contentType="application/json; charset=UTF-8")),$.ajax(c)}},login:function(){if(!this.isDebug&&isWeChatBrowser()){var e=(getCookie("AccessToken"),MasterConfig.C("appId")),o=this._GET().code;if(common.alert("code: "+o),void 0===o){var n=location.origin+common.removeParamFromUrl(["from","code","share_id","isappinstalled","state","m","c","a"]),t=MasterConfig.C("oauthUrl");location.href=t+"appid="+e+"&redirect_uri="+encodeURIComponent(n)+"#wechat_redirect"}else common.alert("start api login"),this.invokeApi("POST","wechat/login/"+o+"?__ph=",null,function(){AJAXFlag=!1},function(o){setCookie("AccessToken",o.access_token,o.expires-10),setCookie("AppId",e,null),setCookie("OpenId",o.open_id,null),setCookie("UserSN",o.user_sn,null),common.alert("access token: "+getCookie("AccessToken")),common.alert("app id: "+getCookie("AppId")),AJAXFlag=!0,location.href=common.removeParamFromUrl(["code"])})}},checkLoginStatus:function(){var e=getCookie("AccessToken"),o=getCookie("AppId"),n=MasterConfig.C("appId");return""!=e&&o==n?void common.alert("good token & app id"):void common.login()},_GET:function(){var e=location.search,o={};if(""==e||void 0==e)return o;e=e.substr(1).split("&");for(var n in e){var t=e[n].split("=");o[t[0]]=t[1]}return o.from&&delete o.code,o},log:function(){for(var e=arguments.length,o=0;e>o;o++)console.log(arguments[o])},alert:function(e){""==getCookie("DevDebug")?console.log(e):alert(e)},getUsersByTime:function(e){return e.sort(sortByJoinedTime),e},loading:function(){var e=$(window).width()<=640?$(window).width():640,o=$(window).height(),n="<iframe  class='loadinged' width='"+e+"' height='"+o+"' frameborder=0 src='loading.html' scrolling='no'></iframe>";$("body").prepend(n),$("body").css("overflow","hidden"),$("body").css("scroll","no"),$("body>div").css("display","none")},clearLoading:function(){$("body>div").css("display","block"),$("body iframe.loadinged").hide(),$("body").css("overflow","visible")},errorTip:function(){var e='<div class="wrapper"></div><div class="box"><p>请重新刷新</p></div>';$("body").prepend(e)},setTitle:function(e){$("title").text(e)},errorProcess:function(e){e.type;switch(e.type){case"refresh":doRefresh();break;case"alert":doAlert(e.text);break;case"redirect":doRedirect(e.text,e.url)}},warmUpCache:function(e,o){function n(e){console.log(e);for(var n in o){var t=o[n];if(t){var i=localStorage.getItem(t.key);i&&(i=JSON.parse(i)),i&&i.version&&i.version>=e&&common.log(i.version)}}}common.invokeApi("GET","project/data_version/"+e+"?_ph=",null,null,function(e){n(e.data_version.version)})},sendStatistics:function(){var e=location.pathname+location.search,o="POST",n="project/statistics?__ph=",t={request_uri:e};common.invokeApi(o,n,t,null,null)},removeParamFromUrl:function(e){var o=common._GET();common.log(o);for(var n in e)delete o[e[n]];return location.pathname+common.buildUrlParamString(o)},buildUrlParamString:function(e){var o="";for(var n in e)o+=n+"="+e[n]+"&";return"?"+o.slice(0,o.length-1)},wechatAuthorize:function(){var e=MasterConfig.C("appId"),o=location.origin+common.removeParamFromUrl(["from","code","share_id","isappinstalled","state","m","c","a"]),n=MasterConfig.C("oauthUrl");location.href=n+"appid="+e+"&redirect_uri="+encodeURIComponent(o)+"#wechat_redirect"}};common.checkLoginStatus(),common.setTitle(MasterConfig.C("shop_name")+"商城");